{% extends 'core/base_main.html' %}

{% block title %}Create new post â€¢ Instagram{% endblock %}

{% block content %}
<div class="create-post-container">
    <div class="create-post-modal">
        <div class="modal-header">
            <h2>Create new post</h2>
            <button class="close-btn" onclick="window.history.back()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="18" x2="6" y1="6" y2="18"/>
                    <line fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="6" x2="18" y1="6" y2="18"/>
                </svg>
            </button>
        </div>

        <form method="post" enctype="multipart/form-data" class="create-post-form" id="createPostForm">
            {% csrf_token %}
            
            <div class="upload-section" id="uploadSection">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <svg width="96" height="77" viewBox="0 0 96 77" fill="currentColor">
                            <path d="M43.5 0h9v77h-9V0z"/>
                            <path d="M0 33.5h96v9H0v-9z"/>
                        </svg>
                    </div>
                    <h3>Drag photos and videos here</h3>
                    <button type="button" class="select-btn" onclick="document.getElementById('imageInput').click()">
                        Select from computer
                    </button>
                    <input type="file" id="imageInput" name="image" accept="image/*" style="display: none;" required>
                </div>
                
                <div class="preview-section" id="previewSection" style="display: none;">
                    <img id="imagePreview" src="/placeholder.svg" alt="Preview" class="image-preview">
                </div>
            </div>

            <div class="post-details" id="postDetails" style="display: none;">
                <div class="post-preview">
                    <img id="finalPreview" src="/placeholder.svg" alt="Post preview" class="final-preview">
                </div>
                
                <div class="post-form">
                    <div class="user-info">
                        <img src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}/static/images/default-avatar.jpg{% endif %}" 
                             alt="{{ user.username }}" class="user-avatar">
                        <span class="username">{{ user.username }}</span>
                    </div>
                    
                    <div class="caption-section">
                        <textarea name="caption" placeholder="Write a caption..." class="caption-input" maxlength="2200"></textarea>
                        <div class="caption-counter">
                            <span id="captionCount">0</span>/2,200
                        </div>
                    </div>
                    
                    <div class="accessibility-section">
                        <div class="section-header">
                            <span>Accessibility</span>
                        </div>
                        <p class="section-description">
                            Alt text describes your photos for people with visual impairments. Alt text will be automatically created for your photos or you can choose to write your own.
                        </p>
                        <div class="alt-text-input">
                            <img id="altTextPreview" src="/placeholder.svg" alt="Alt text preview" class="alt-preview">
                            <input type="text" placeholder="Write alt text..." class="alt-input">
                        </div>
                    </div>
                    
                    <div class="advanced-settings">
                        <div class="setting-item">
                            <span>Hide like and view counts on this post</span>
                            <label class="toggle">
                                <input type="checkbox" name="hide_counts">
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <span>Turn off commenting</span>
                            <label class="toggle">
                                <input type="checkbox" name="disable_comments">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer" id="modalFooter">
                <button type="button" class="back-btn" id="backBtn" style="display: none;" onclick="goBack()">Back</button>
                <button type="button" class="next-btn" id="nextBtn" style="display: none;" onclick="showDetails()">Next</button>
                <button type="submit" class="share-btn" id="shareBtn" style="display: none;">Share</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const imageInput = document.getElementById('imageInput');
    const uploadArea = document.getElementById('uploadArea');
    const uploadSection = document.getElementById('uploadSection');
    const previewSection = document.getElementById('previewSection');
    const postDetails = document.getElementById('postDetails');
    const imagePreview = document.getElementById('imagePreview');
    const finalPreview = document.getElementById('finalPreview');
    const altTextPreview = document.getElementById('altTextPreview');
    const nextBtn = document.getElementById('nextBtn');
    const backBtn = document.getElementById('backBtn');
    const shareBtn = document.getElementById('shareBtn');
    const captionInput = document.querySelector('.caption-input');
    const captionCount = document.getElementById('captionCount');

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('drag-over');
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            handleImageSelect(files[0]);
        }
    });

    // File input change
    imageInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            handleImageSelect(e.target.files[0]);
        }
    });

    // Handle image selection
    function handleImageSelect(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            imagePreview.src = e.target.result;
            finalPreview.src = e.target.result;
            altTextPreview.src = e.target.result;
            
            uploadSection.style.display = 'none';
            previewSection.style.display = 'block';
            nextBtn.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }

    // Show post details
    function showDetails() {
        previewSection.style.display = 'none';
        postDetails.style.display = 'flex';
        nextBtn.style.display = 'none';
        backBtn.style.display = 'block';
        shareBtn.style.display = 'block';
    }

    // Go back to preview
    function goBack() {
        postDetails.style.display = 'none';
        previewSection.style.display = 'block';
        backBtn.style.display = 'none';
        shareBtn.style.display = 'none';
        nextBtn.style.display = 'block';
    }

    // Caption counter
    captionInput.addEventListener('input', () => {
        captionCount.textContent = captionInput.value.length;
    });

    // Form submission
    document.getElementById('createPostForm').addEventListener('submit', (e) => {
        if (!imageInput.files.length) {
            e.preventDefault();
            alert('Please select an image');
        }
    });
</script>
{% endblock %}
